<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Inai.App.Pages.ChatPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:Inai.App.Converters"
             xmlns:core="clr-namespace:Inai.Core.Models;assembly=Inai.Core"
             xmlns:vm="clr-namespace:Inai.App.ViewModels"
             x:DataType="vm:ChatViewModel">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:BoolToAlignmentConverter x:Key="BoolToAlignment" />
            <conv:BoolToColorConverter x:Key="BoolToColor" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.BindingContext>
        <vm:ChatViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="*,Auto">
        <CollectionView x:Name="MessagesView"
                        Margin="10"
                        BackgroundColor="White"
                        ItemsSource="{Binding Messages}"
                        SelectionMode="None"
                        VerticalOptions="Fill">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="core:ChatMessage">
                    <Border Margin="5"
                            Padding="10"
                            BackgroundColor="{Binding IsFromAI, Converter={StaticResource BoolToColor}}"
                            HorizontalOptions="{Binding IsFromAI, Converter={StaticResource BoolToAlignment}}"
                            StrokeShape="RoundRectangle 15">
                        <Label LineBreakMode="WordWrap" Text="{Binding Message}" />
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <StackLayout Grid.Row="1"
                     Padding="10"
                     Orientation="Horizontal"
                     Spacing="10">
            <Entry HorizontalOptions="Fill"
                   Placeholder="Type a message..."
                   Text="{Binding UserMessage}" />
            <Button Command="{Binding SendCommand}" Text="Send" />
        </StackLayout>
    </Grid>
</ContentPage>
